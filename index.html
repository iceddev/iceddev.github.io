<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>
    Iced Blog
  </title>
  <meta name="description" content="Blog for and by Iced Dev">

  <meta name="author" content="Iced Dev">
  <meta name="ROBOTS" content="ALL">

  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link href="favicon.png" rel="icon">

  <link rel="alternate" type="application/rss+xml" title="Iced Blog - feed" href="/index.xml" />
  <link href='http://fonts.googleapis.com/css?family=Bowlby+One+SC' rel='stylesheet' type='text/css'>
  <link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
  <link type="text/css" rel="stylesheet" href="static/styles/normalize.css">
  <link type="text/css" rel="stylesheet" href="static/styles/prism.css">
  <link type="text/css" rel="stylesheet" href="static/styles/jsdoc-default.css">

  <style>
    .main {
      margin-top: 15px;
    }
  </style>

  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-27771989-3', 'iceddev.com');
    ga('send', 'pageview');

  </script>
  <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
</head>
<body class="language-javascript examplepage">
  <header class="header">
    <h1 class="logo">Iced Blog</h1>

    <nav class="mainnav">
      <a href="http://iceddev.com">Home</a>
      <a href="http://blog.iceddev.com">Blog</a>
    </nav>
  </header>

  <div class="main">
    <section>
      <article>
        <div class="articles">

<article class="post">
  <div class="title">
    <h1><a href="./2013-12-23-beefy-workflow-with-requirejs.html">beefy workflow with requirejs</a></h1>
    <p class="post-date">december 23rd 2013</p>
  </div>
  <div class="post-content">
    <p>Sometimes you want to work on your AMD code as a single bundle; the same way it will
be deployed in production, with automatic bundling and live reload. Thanks to
<a href="https://twitter.com/isntitvacant">Chris Dickinson&#39;s</a> recent work on the beefy development
server, it&#39;s now easier to use r.js as a custom bundler.</p>
<p>Let’s get it configured.</p>
<h2>What is beefy?</h2>
<p><a href="https://github.com/chrisdickinson/beefy">beefy</a> is a static web server with built-in JavaScript bundling.</p>
<p>It was made to work with browserify by default, but if you use the <code>--bundler</code>
command line argument, you can specify r.js as your bundler of choice.</p>
<p>We are going to use this to run r.js each time our <code>main.js</code> file is requested.</p>
<p>Get beefy by using the command:</p>
<pre><code class="lang-bash">npm install -g beefy</code></pre>
<h2>What is r.js?</h2>
<p><a href="https://github.com/jrburke/r.js">r.js</a> is a command line utility designed for running
<a href="https://github.com/amdjs/amdjs-api/wiki">AMD</a>-based projects in node.js, Rhino, and xpcshell.
It also includes an optimizer for combining your AMD files into a bundle.</p>
<p>By using the optimizer functionality of r.js, in combination with beefy, we can
bundle our JavaScript on each page refresh.</p>
<p>We need to install r.js into our project using the command:</p>
<pre><code class="lang-bash">npm install requirejs</code></pre>
<p>If you have a <code>package.json</code> and want to add it to your devDependencies, add <code>--save-dev</code>
to the command:</p>
<pre><code class="lang-bash">npm install --save-dev requirejs</code></pre>
<h2>Minimum Viable Config</h2>
<p>There are seven options we need to set in our r.js config file that will allow us to use
it with beefy (actually, two are just nice to have).  They are <code>baseUrl</code>, <code>name</code>, <code>insertRequire</code>,
<code>optimize</code>, <code>useSourceUrl</code>, <code>out</code> and <code>logLevel</code> and each one is explained below.</p>
<p>These options will be set in a file named <code>config.js</code>, which will be passed to the beefy
command.</p>
<p>You can find an example project at <a href="https://github.com/iceddev/beefy-requirejs-example">https://github.com/iceddev/beefy-requirejs-example</a></p>
<h2><code>baseUrl</code></h2>
<p>As with every Require.js project, you are going to want to set your <code>baseUrl</code>.</p>
<p>This could be any place you want to begin resolving. Typically, it will be
your vendor or application directory. Since we are doing a simple example,
let&#39;s just use our current directory and we will put our JS files at the root
of our project.</p>
<pre><code class="lang-javascript"><span class="comment">// config.js</span>
({
  baseUrl: <span class="string">'./'</span>
})</code></pre>
<h2><code>name</code></h2>
<p>To specify the module (and all of its dependencies) we want to optimize,
we use the <code>name</code> option. This option indicates an entry point for r.js
to begin resolving dependencies.</p>
<p>We are going to name our entry module <code>main.js</code>, an AMD package convention,
and it will be in the root of our project.</p>
<pre><code class="lang-javascript"><span class="comment">// config.js</span>
({
  baseUrl: <span class="string">'./'</span>,
  name: <span class="string">'main'</span> <span class="comment">// drop the .js, as AMD moduleId resolution appends it</span>
})</code></pre>
<h3><code>main.js</code></h3>
<p>Create a file in the root of your project named <code>main.js</code>.</p>
<p>This file will be the entry point for your applicaton, and will be wrapped
in a <code>define</code> function call.</p>
<pre><code class="lang-javascript"><span class="comment">// main.js</span>
define([
  <span class="string">'./another-module'</span>
], <span class="keyword">function</span>(another){

  console.log(<span class="string">'inside main.js'</span>);

  console.log(<span class="string">'another-module dependency:'</span>, another);

});</code></pre>
<h3><code>another-module.js</code></h3>
<p>Create another file in the root of your project, but name this one <code>another-module.js</code>.</p>
<p>This file is a dependency of your <code>main.js</code> module and is just used to demonstrate that
we are, in fact, bundling all the dependencies together.</p>
<pre><code class="lang-javascript"><span class="comment">// another-module.js</span>
define(<span class="keyword">function</span>(){

  console.log(<span class="string">'inside another-module.js'</span>);

  <span class="keyword">return</span> {
    something: <span class="string">'yup, another module'</span>
  };

});</code></pre>
<h2><code>insertRequire</code></h2>
<p>We can specify the <code>insertRequire</code> option, to insert a <code>require</code> function call at the bottom of
our bundle, which will initialize your application.</p>
<p>Note: This isn&#39;t needed if your <code>data-main</code> filename is the same as the module entrypoint name
because Require.js will do an implicit <code>require</code>. We will add it here because it doesn&#39;t hurt
anything and will help in situations like naming the files differently or using something like
<a href="https://github.com/jrburke/almond">almond</a>.</p>
<pre><code class="lang-javascript"><span class="comment">// config.js</span>
({
  baseUrl: <span class="string">'./'</span>,
  name: <span class="string">'main'</span>,
  insertRequire: [<span class="string">'main'</span>] <span class="comment">// will add `require(['main'])` to the end of your bundle</span>
})</code></pre>
<h2><code>optimize</code></h2>
<p>During development, you probably want to disable optimization/uglification, so you will
be able to debug your bundle and builds will happen quicker. This is done by setting
the <code>optimize</code> option to <code>&#39;none&#39;</code>.</p>
<pre><code class="lang-javascript"><span class="comment">// config.js</span>
({
  baseUrl: <span class="string">'./'</span>,
  name: <span class="string">'main'</span>,
  insertRequire: [<span class="string">'main'</span>],
  optimize: <span class="string">'none'</span>
})</code></pre>
<h2><code>useSourceUrl</code> - Source Maps</h2>
<p>When using the <code>optimize: &#39;none&#39;</code> option, we can get source maps, using <code>//# sourceURL=</code>
and an <code>eval</code> call.</p>
<p>Setting the <code>useSourceUrl</code> option to <code>true</code> will auto insert these for you, but it should
be disabled when bundling for production.</p>
<pre><code class="lang-javascript"><span class="comment">// config.js</span>
({
  baseUrl: <span class="string">'./'</span>,
  name: <span class="string">'main'</span>,
  insertRequire: [<span class="string">'main'</span>],
  optimize: <span class="string">'none'</span>,
  useSourceUrl: <span class="literal">true</span>
})</code></pre>
<h2><code>out</code></h2>
<p>The typical way r.js is used is to output a file, determined by providing
a filename string as the <code>out</code> option.</p>
<p>beefy doesn&#39;t operate on files, and instead expects to receive data on
<code>process.stdout</code>.</p>
<p>The <code>out</code> option can also take a function that will receive the output
text as its only parameter.</p>
<p>We are going to leverage the <code>out</code> function to redirect the r.js output
to <code>process.stdout</code>.</p>
<pre><code class="lang-javascript"><span class="comment">// config.js</span>
({
  baseUrl: <span class="string">'./'</span>,
  name: <span class="string">'main'</span>,
  insertRequire: [<span class="string">'main'</span>],
  optimize: <span class="string">'none'</span>,
  useSourceUrl: <span class="literal">true</span>,
  out: console.log <span class="comment">// console.log outputs to process.stdout and is tightly bound in node</span>
})</code></pre>
<h2><code>logLevel</code></h2>
<p>By default, r.js logs info about the build process.  This gets intercepted
by beefy on <code>process.stdout</code> and is added to the output served.</p>
<p>r.js provides a <code>logLevel</code> option that can be used to disable logging.  Log level 3 is
the level that logs only errors.</p>
<pre><code class="lang-javascript"><span class="comment">// config.js</span>
({
  baseUrl: <span class="string">'./'</span>,
  name: <span class="string">'main'</span>,
  insertRequire: [<span class="string">'main'</span>],
  optimize: <span class="string">'none'</span>,
  useSourceUrl: <span class="literal">true</span>,
  out: console.log,
  logLevel: <span class="number">3</span>
})</code></pre>
<h2><code>index.html</code></h2>
<p>The last thing we need is an <code>index.html</code> file that includes Require.js. If an <code>index.html</code>
file doesn&#39;t exist, beefy serves up a default page that just injects a script tag for your
entrypoint file. This won&#39;t work with the workflow outlined above because we assume the
require machinery will be available.</p>
<p>Create an <code>index.html</code> file in the root of your project that contains:</p>
<pre><code class="lang-html"><span class="doctype">&lt;!DOCTYPE html&gt;</span>
<span class="tag">&lt;<span class="title">html</span> <span class="attribute">lang</span>=<span class="value">"en"</span>&gt;</span>
<span class="tag">&lt;<span class="title">head</span>&gt;</span>
  <span class="tag">&lt;<span class="title">meta</span> <span class="attribute">charset</span>=<span class="value">"UTF-8"</span>&gt;</span>
  <span class="tag">&lt;<span class="title">title</span>&gt;</span>Beefy + Require.js<span class="tag">&lt;/<span class="title">title</span>&gt;</span>
<span class="tag">&lt;/<span class="title">head</span>&gt;</span>
<span class="tag">&lt;<span class="title">body</span>&gt;</span>
  <span class="tag">&lt;<span class="title">script</span> <span class="attribute">src</span>=<span class="value">"/node_modules/requirejs/require.js"</span> <span class="attribute">data-main</span>=<span class="value">"main"</span> <span class="attribute">type</span>=<span class="value">"text/javascript"</span>&gt;</span><span class="javascript"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span>
<span class="tag">&lt;/<span class="title">body</span>&gt;</span>
<span class="tag">&lt;/<span class="title">html</span>&gt;</span></code></pre>
<h2>Run beefy</h2>
<p>The beefy command takes a filename as the first argument, or an input filename/output filename combination
in the form of <code>input-filename.js:output-filename.js</code>. If you don&#39;t specify an input filename but specify an
output filename, in the format <code>:output-filename.js</code>, beefy won&#39;t pass a filename to the bundler, but it will
still make the result of the bundler command available as <code>output-filename.js</code>.</p>
<p>r.js assumes it is supposed to run a file if one is passed as the first argument to the command, and skips the optimization
tool. To avoid this, we will specify the first beefy argument as <code>:main.js</code>.</p>
<p>Next, we want to reference the r.js compiler as the bundler: <code>--bundler ./node_modules/.bin/r.js</code></p>
<p>Finally, r.js expects the <code>-o config.js</code> argument to start the optimize tool with the <code>config.js</code> file. Anything
after the <code>--</code> argument to beefy is passed directly to the bundler command.</p>
<p>Putting it all together, the command looks like:</p>
<pre><code class="lang-bash">beefy :main.js --bundler ./node_modules/.bin/r.js -- -o config.js</code></pre>
<h2>Accessing your bundle</h2>
<p>Open your browser and go to the location that the beefy command said it is listening on,
e.g. <code>listening on http://localhost:9966/</code>.</p>
<p>You should see logging in your console if your modules loaded correctly. You should also
be able to view the individual files in the <code>sources</code> pane, probably under (no domain)
since we were using the <code>useSourceUrl</code> option.</p>
<h2>What else can we do?</h2>
<p>This configuration will allow you easily to swap dependencies with a single line change.</p>
<pre><code class="lang-javascript"><span class="comment">// config.js</span>
({
  <span class="comment">// rest of the config</span>
  paths: {
    underscore: <span class="string">'node_modules/underscore/underscore'</span>
  }
})</code></pre>
<p>Can be changed to:</p>
<pre><code class="lang-javascript"><span class="comment">// config.js</span>
({
  <span class="comment">// rest of the config</span>
  paths: {
    underscore: <span class="string">'node_modules/lodash/dist/lodash'</span>
  }
})</code></pre>
<p>And your underscore references will resolve to Lo-Dash on the next refresh of your page.</p>
<p>Watch out for part two of this article for some advanced techniques and any other interesting
stuff I find related to AMD and beefy.</p>
<p>-Blaine</p>

  </div>
  <div class="post-navigation">
  
    <span class="comment-link"><a href="./2013-12-23-beefy-workflow-with-requirejs.html#comments">View Comments</a></span>
  
  </div>
</article>

  
  <hr />
  

<article class="post">
  <div class="title">
    <h1><a href="./2013-07-30-controlling-drones-with-google-glass-and-javascript.html">controlling drones with google glass and javascript</a></h1>
    <p class="post-date">july 30th 2013</p>
  </div>
  <div class="post-content">
    <p>This past weekend (July 27, 2013) was <a href="http://nodebotsday.com">International Nodebots Day</a> and I decided
to attend Portland&#39;s event.</p>
<p>The event was excellent and I would like to give props to all the organizers,
<a href="https://twitter.com/hackygolucky">Tracy</a>, <a href="https://twitter.com/thoward37">Troy</a>,
<a href="https://twitter.com/adron">Adron</a>, <a href="https://twitter.com/carterrabasa">Carter</a>,
<a href="https://twitter.com/_jden">Jason</a>, <a href="https://twitter.com/s5fs">Adam</a> &amp; anyone else
I might have forgotten, who were able to bring people of all skill levels and
interests together to control hardware with JavaScript.</p>
<p>Some projects I had interest in working on involved using different input devices
to control robots with a small JS layer in between.</p>
<p>The hardware I brought to work with was LeapMotion, Google Glass, and Shieldbots.
I was also hoping someone would bring a NodeCopter.</p>
<p>The goal was to use the input devices to control the bots, all using JavaScript.</p>
<p><img src="https://pbs.twimg.com/media/BQN9iHbCYAAJOo1.jpg" alt="Flying a Drone with Glass #1"></p>
<p>Photo by <a href="https://twitter.com/alicegoldfuss/status/361270420172857344">Alice Goldfuss</a></p>
<h2>Leap + Bots</h2>
<p>I got started a day early with <a href="https://twitter.com/thoward37">Troy</a> and
<a href="https://twitter.com/nickniemeir">Nick</a> while hacking at the
<a href="https://twitter.com/newrelic">New Relic</a> offices.</p>
<p>The first thing we did was read the input data from <a href="https://www.leapmotion.com/">LeapMotion&#39;s</a>
WebSocket connection and use it to drive a <a href="http://www.seeedstudio.com/depot/shield-bot-p-1380.html">ShieldBot</a>
around using <a href="https://github.com/rwldrn/johnny-five">johnny-five</a>,
<a href="https://github.com/phated/shieldbot.js">shieldbot.js</a>, and <a href="http://js.leapmotion.com/">leapjs</a>.</p>
<pre><code class="lang-javascript"><span class="keyword">var</span> five = require(<span class="string">'johnny-five'</span>);
<span class="keyword">var</span> Shieldbot = require(<span class="string">'shieldbot'</span>);
<span class="keyword">var</span> leap = require(<span class="string">'leapjs'</span>);
<span class="keyword">var</span> board = <span class="keyword">new</span> five.Board();

board.on(<span class="string">'ready'</span>, <span class="keyword">function</span>(){

  <span class="keyword">var</span> shieldbot = <span class="keyword">new</span> Shieldbot();
  <span class="keyword">var</span> prevZ;

  leap.loop(<span class="keyword">function</span>(frame){
    <span class="keyword">if</span>(frame.hands.length){
      <span class="keyword">var</span> z = frame.hands[<span class="number">0</span>].palmPosition[<span class="number">2</span>];
      <span class="keyword">var</span> velZ = frame.hands[<span class="number">0</span>].palmVelocity[<span class="number">2</span>];

      <span class="keyword">if</span>(prevZ == <span class="literal">null</span>){
        prevZ = z;
      }

      <span class="keyword">var</span> direction;
      <span class="keyword">if</span>(z &lt; prevZ &amp;&amp; Math.abs(velZ) &gt; <span class="number">50</span>){
        direction = <span class="string">'forward'</span>;
        shieldbot.forward(<span class="number">127</span>, <span class="number">30</span>);
      } <span class="keyword">else</span> <span class="keyword">if</span>(z &gt; prevZ &amp;&amp; Math.abs(velZ) &gt; <span class="number">50</span>){
        direction = <span class="string">'backward'</span>;
        shieldbot.reverse(<span class="number">127</span>, <span class="number">30</span>);
      } <span class="keyword">else</span> {
        direction = <span class="string">'still'</span>;
        shieldbot.stop();
      }

      prevZ = z;
    } <span class="keyword">else</span> {
      shieldbot.stop();
    }
  });

});</code></pre>
<p>We used the Leap&#39;s z-axis velocity tracking of a user&#39;s palm to drive the bot
forward and backwards.</p>
<p><iframe class="vine-embed" src="https://vine.co/v/hAexmlaWBUU/embed/simple" width="600" height="600" frameborder="0"></iframe></p>
<script async src="//platform.vine.co/static/scripts/embed.js" charset="utf-8"></script>

<p>During Nodebots Day, I was able to add left &amp; right stearing using palm x-axis rotation.</p>
<pre><code class="lang-javascript"><span class="comment">// outside leap.loop</span>
<span class="keyword">var</span> prevX;

<span class="comment">// inside leap.loop</span>
<span class="keyword">var</span> velX = frame.hands[<span class="number">0</span>].palmVelocity[<span class="number">0</span>];
<span class="keyword">var</span> x = frame.hands[<span class="number">0</span>].palmNormal[<span class="number">0</span>];

<span class="keyword">if</span>(direction === <span class="string">'still'</span>){
  <span class="keyword">if</span>(x &gt; prevX &amp;&amp; Math.abs(velX) &gt; <span class="number">50</span>){
    shieldbot.turnRight(<span class="number">127</span>, <span class="number">30</span>);
  } <span class="keyword">else</span> <span class="keyword">if</span>(x &lt; prevX  &amp;&amp; Math.abs(velX) &gt; <span class="number">50</span>){
    shieldbot.turnLeft(<span class="number">127</span>, <span class="number">30</span>);
  } <span class="keyword">else</span> {
    shieldbot.stop();
  }
}

prevX = x;</code></pre>
<p>Other plans included using the finders to stop the bot running into things or off tables, but
I was unable to implement these because I quickly moved on to my next input device, Google Glass.</p>
<h2>Glass + Bots</h2>
<p>For his <a href="https://github.com/jsconf/jsconfus2013/issues/13">JSConf</a> talk, Luis created a
sideloadable app, <a href="https://github.com/monteslu/Face">Face</a>, for Glass that broadcast
the sensor data over WebSockets.  With this, I was able to get pitch and roll, which
were both easily translated to the logic of the LeapMotion/ShieldBot combo.</p>
<pre><code class="lang-javascript"><span class="keyword">var</span> five = require(<span class="string">'johnny-five'</span>);
<span class="keyword">var</span> Shieldbot = require(<span class="string">'shieldbot'</span>);

<span class="keyword">var</span> io = require(<span class="string">'socket.io-client'</span>);
<span class="keyword">var</span> socket = io.connect(<span class="string">'http://localhost:11097'</span>);
socket.on(<span class="string">'connect'</span>, <span class="keyword">function</span>(){
  socket.emit(<span class="string">'joinChannel'</span>, CHAN_ID_FROM_FACE);
});

<span class="keyword">var</span> board = <span class="keyword">new</span> five.Board();

board.on(<span class="string">'ready'</span>, <span class="keyword">function</span>(){

  <span class="keyword">var</span> shieldbot = <span class="keyword">new</span> Shieldbot();
  <span class="keyword">var</span> prevZ;
  <span class="keyword">var</span> prevX;

  socket.on(<span class="string">'broadcast'</span>, <span class="keyword">function</span>(message){
    <span class="keyword">if</span>(message.sensors){
      <span class="keyword">var</span> z = message.sensors.pitch;
      <span class="keyword">var</span> x = message.sensors.roll;

      <span class="keyword">if</span>(prevZ == <span class="literal">null</span>){
        prevZ = z;
      }

      <span class="keyword">var</span> direction;
      <span class="keyword">if</span>(z &gt; prevZ &amp;&amp; Math.abs(z - prevZ) &gt; <span class="number">1</span>){
        direction = <span class="string">'forward'</span>;
        shieldbot.forward(<span class="number">127</span>, <span class="number">30</span>);
      } <span class="keyword">else</span> <span class="keyword">if</span>(z &lt; prevZ &amp;&amp; Math.abs(z - prevZ) &gt; <span class="number">1</span>){
        direction = <span class="string">'backward'</span>;
        shieldbot.reverse(<span class="number">127</span>, <span class="number">30</span>);
      } <span class="keyword">else</span> {
        direction = <span class="string">'still'</span>;
        shieldbot.stop();
      }

      <span class="keyword">if</span>(direction === <span class="string">'still'</span>){
        <span class="keyword">if</span>(x &gt; prevX &amp;&amp; Math.abs(x - prevX) &gt; <span class="number">1</span>){
          shieldbot.turnRight(<span class="number">127</span>, <span class="number">30</span>);
        } <span class="keyword">else</span> <span class="keyword">if</span>(x &lt; prevX  &amp;&amp; Math.abs(x - prevX) &gt; <span class="number">1</span>){
          shieldbot.turnLeft(<span class="number">127</span>, <span class="number">30</span>);
        } <span class="keyword">else</span> {
          shieldbot.stop();
        }
      }

      prevZ = z;
      prevX = x;
    } <span class="keyword">else</span> {
      shieldbot.stop();
    }
  });

});</code></pre>
<p>After replacing some variables and reworking my velocity check, I was able to drive the bot
forward and backward, matching the direction I tilted my head.  Rolling my head left
and right also turned the bot.</p>
<p><iframe class="vine-embed" src="https://vine.co/v/hq620P0Qgjx/embed/simple" width="600" height="600" frameborder="0"></iframe></p>
<script async src="//platform.vine.co/static/scripts/embed.js" charset="utf-8"></script>

<p>This demo wasn&#39;t ideal because I couldn&#39;t see where the bot was while controlling it.
I needed something that could be about eye height, so I could see its movement while
controlling it.  Luckily, <a href="https://twitter.com/carterrabasa">Carter</a> had brought a <a href="http://nodecopter.com/">NodeCopter</a>!!</p>
<p><iframe class="vine-embed" src="https://vine.co/v/hAgvjhl0zLA/embed/simple" width="600" height="600" frameborder="0"></iframe></p>
<script async src="//platform.vine.co/static/scripts/embed.js" charset="utf-8"></script>

<p><iframe src="http://player.vimeo.com/video/71408246" width="600" height="338" frameborder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe></p>

<h2>Glass + NodeCopter</h2>
<p>If it was so easy to switch the LeapMotion logic to use the Glass data, I figured it
would be just as easy to swap the ShieldBot logic for the NodeCopter&#39;s.  After
discussing the idea with a few people, it was suggested I use the <a href="https://github.com/shama/voxel-drone">Voxel Drone</a>
to test my logic before applying it to a physical drone.  After a very frustrating
experience trying to get Voxel Drone, which seems to have been abandoned, to actually
work, I was able to wire up my Glass/NodeCopter logic and added code for the drone to
take off with the A button and land with the B button displayed in Glass.</p>
<pre><code class="lang-javascript"><span class="keyword">var</span> io = require(<span class="string">'socket.io-client'</span>);
<span class="keyword">var</span> socket = io.connect(<span class="string">'http://localhost:11097'</span>);
socket.on(<span class="string">'connect'</span>, <span class="keyword">function</span>(){
  socket.emit(<span class="string">'joinChannel'</span>, CHAN_ID_FROM_FACE);
});

<span class="keyword">var</span> prevZ;
<span class="keyword">var</span> prevX;

socket.on(<span class="string">'broadcast'</span>, <span class="keyword">function</span>(message){

  <span class="keyword">if</span>(message.event){
    <span class="keyword">if</span>(message.event === <span class="string">'A'</span>){
      drone.takeoff();
    }
    <span class="keyword">if</span>(message.event === <span class="string">'B'</span>){
      drone.land();
    }
    <span class="keyword">return</span>;
  }
  <span class="keyword">if</span>(message.sensors){
    <span class="keyword">var</span> z = message.sensors.pitch;
    <span class="keyword">var</span> x = message.sensors.roll;

    <span class="keyword">if</span>(prevZ == <span class="literal">null</span>){
      prevZ = z;
    }

    <span class="keyword">var</span> direction;
    <span class="keyword">if</span>(z &gt; prevZ &amp;&amp; Math.abs(z - prevZ) &gt; <span class="number">1</span>){
      direction = <span class="string">'forward'</span>;
      drone.front(<span class="number">1</span>);
    } <span class="keyword">else</span> <span class="keyword">if</span>(z &lt; prevZ &amp;&amp; Math.abs(z - prevZ) &gt; <span class="number">1</span>){
      direction = <span class="string">'backward'</span>;
      drone.back(<span class="number">1</span>);
    } <span class="keyword">else</span> {
      direction = <span class="string">'still'</span>;
      drone.stop();
    }

    <span class="keyword">if</span>(direction === <span class="string">'still'</span>){
      <span class="keyword">if</span>(x &gt; prevX &amp;&amp; Math.abs(x - prevX) &gt; <span class="number">1</span>){
        drone.right(<span class="number">1</span>);
      } <span class="keyword">else</span> <span class="keyword">if</span>(x &lt; prevX  &amp;&amp; Math.abs(x - prevX) &gt; <span class="number">1</span>){
        drone.left(<span class="number">1</span>);
      } <span class="keyword">else</span> {
        drone.stop();
      }
    }

    prevZ = z;
    prevX = x;
  } <span class="keyword">else</span> {
    drone.stop();
  }

});</code></pre>
<p>I loaded up Voxel Drone and was able to fly a WebGL drone in my browser.</p>
<p>All I needed to do was swap the voxel-drone specific code for:</p>
<pre><code class="lang-javascript"><span class="keyword">var</span> arDrone = require(<span class="string">'ar-drone'</span>);
<span class="keyword">var</span> drone  = arDrone.createClient({
  ip: <span class="string">'192.168.1.10'</span>
});</code></pre>
<h2>Demos</h2>
<p><img src="https://pbs.twimg.com/media/BQOckcxCAAMZtLA.jpg" alt="Flying a Drone with Glass #2"></p>
<p>Photo by <a href="https://twitter.com/cxhansen/status/361304545126645760">Chris Hansen</a></p>
<p><iframe width="600" height="450" src="//www.youtube.com/embed/BSXWkidgA1Q?rel=0" frameborder="0" allowfullscreen></iframe></p>

<p><iframe src="http://player.vimeo.com/video/71405845" width="600" height="337" frameborder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe></p>

<p>Turns out that I was driving the drone at full speed in each direction I tilted my head.
I should have had the speed at about 0.3 instead of 1.  Lesson learned.  I would have also
liked to add the ability to rotate the drone left and right based on the Glass&#39; azimuth value,
but I guess that will have to be in the future.</p>
<h2>Wrapping Up</h2>
<p>With JavaScript, we are able to write a relatively small amount of code that can serve as a basis for swappable hardware components.</p>
<p>I was able to start with a LeapMotion and Shieldbot and end up using Google Glass and a NodeCopter with quite similar code.</p>
<p>After such an amazing Nodebots Day, I have all sorts of ideas swimming around in my head for taking these types of interactions further!</p>
<p>-Blaine</p>

  </div>
  <div class="post-navigation">
  
    <span class="comment-link"><a href="./2013-07-30-controlling-drones-with-google-glass-and-javascript.html#comments">View Comments</a></span>
  
  </div>
</article>

  
  <hr />
  

<article class="post">
  <div class="title">
    <h1><a href="./2012-11-05-node-js-in-chrome.html">node js in chrome</a></h1>
    <p class="post-date">november 5th 2012</p>
  </div>
  <div class="post-content">
    <p>This:</p>
<pre><code><span class="tag">&lt;<span class="title">script</span> <span class="attribute">type</span>=<span class="value">"text/javascript"</span> <span class="attribute">src</span>=<span class="value">"node.js"</span>&gt;</span><span class="javascript"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></code></pre>
<p>Allows you to do this in a Chrome App:</p>
<pre><code class="lang-javascript"><span class="keyword">var</span> http = require(<span class="string">'http'</span>);
http.createServer(<span class="function"><span class="keyword">function</span> <span class="params">(req, res)</span> {</span>
    res.writeHead(<span class="number">200</span>, {<span class="string">'Content-Type'</span>: <span class="string">'text/plain'</span>});
    res.end(<span class="string">'Hello World\n'</span>);
}).listen(<span class="number">1337</span>, <span class="string">'127.0.0.1'</span>);
console.log(<span class="string">'Server running at http://127.0.0.1:1337/'</span>);</code></pre>
<h2>This is actually Node.js code running the http listener on Chrome&#39;s Javascript VM!</h2>
<p>While we like the <a href="http://browserver.org/">Browserver project</a>, it uses a reverse proxy and pushes requests down to the client via a websocket.  Node-chromify took a different approach, and has no external server dependency.</p>
<p>You can get the source to the demo app, and a build of node.js (the script, not the whole node project) here:  <a href="https://github.com/iceddev/node-chromify"><a href="https://github.com/iceddev/node-chromify">https://github.com/iceddev/node-chromify</a></a></p>
<h2>So, how did we do this?</h2>
<p><a href="https://github.com/iceddev/node-chromify">node-chromify</a> is built on top of <a href="https://github.com/substack/node-browserify">browserify</a>, which allows node modules to be converted into a format that can be run in a browser.
Browsers can&#39;t normally created TCP listeners, but Chrome Apps can in Canary with the experimental extension APIs flag enabled.</p>
<p>Google&#39;s Paul Kinlan created a net-browserify module which wraps the Chrome API calls to the node.js &quot;net&quot; package.  This gets us quite a bit further. We&#39;ve <a href="https://github.com/iceddev/net-chromify">patched</a> a few things on this to help us out.</p>
<p>We&#39;ve created an <a href="https://github.com/iceddev/http-chromify">http-chromify</a> module which is based on Node.js&#39; &quot;http&quot; module.  The Node.js version uses native C++ code to parse the HTTP messages between client and server.  We replaced that with the pure JS <a href="https://github.com/creationix/http-parser-js">http-parser-js</a> module.</p>
<p>There were also couple of other pure JS modules that weren&#39;t browserified yet, namely <a href="https://github.com/iceddev/freelist-chromify">freelist</a> and <a href="https://github.com/iceddev/string_decoder-chromify">string_decoder</a>.  We created repos for those so that browserify could pull them in.</p>
<p>Finally we used the excellent <a href="http://gruntjs.com/">Grunt.js</a> to build and package this all up into <a href="https://github.com/iceddev/node-chromify">node-chromify</a>.</p>
<h2>How do you run it?</h2>
<p>You&#39;ll need Chrome Canary to run the demo.  Canary has recently allowed developers the ability to open TCP socket listeners in apps and extensions.</p>
<p>Also, this requires enabling &quot;Experimental Extension APIs&quot; from chrome://flags</p>
<p>Then, in chrome://extensions  use the &quot;Load unpacked extension...&quot; to point to the examples/plugin folder in the <a href="https://github.com/iceddev/node-chromify">node-chromify</a> source.</p>
<p>We&#39;re accepting pull request to <a href="https://github.com/iceddev/node-chromify">node-chromify</a>, please help us fix this :)</p>
<h2>Why did we do this?</h2>
<p>&quot;any application that can be written in JavaScript, will eventually be written in JavaScript.&quot;</p>
<p>It&#39;s the law.  Obey the law.</p>

  </div>
  <div class="post-navigation">
  
    <span class="comment-link"><a href="./2012-11-05-node-js-in-chrome.html#comments">View Comments</a></span>
  
  </div>
</article>

  
  <hr />
  

<article class="post">
  <div class="title">
    <h1><a href="./2012-02-25-create-and-deploy-a-nodester-app-without-installing-git-using-cloud9-ide.html">create and deploy a nodester app without installing git using cloud9 ide</a></h1>
    <p class="post-date">february 25th 2012</p>
  </div>
  <div class="post-content">
    <p>At Iced Dev, our main business is consulting for Node.js and building
great web applications using it with HTML5 technologies. Our favorite
hosting platform is <a href="http://nodester.com" title="Nodester">Nodester</a> (<a href="http://twitter.com/nodester" title="Nodester">@Nodester</a>) because it is the only
Open-Source PaaS for Node.js and maintained by a great group of
developers. Recently, Nodester
redesigned their website and made it extremely easy to use their API
using <a href="http://apigee.com" title="apigee">apigee’s</a> API Explorer.  This is very helpful for people using
Windows because curl is no longer required to request an invite, but
Window’s users may still have trouble using Nodester because Git is used
to push your project to the Nodester platform. For our Node.js
development, we typically use <a href="http://c9.io" title="Cloud9 IDE">Cloud9 IDE</a> because it is very easy to
debug our Node.js apps before we deploy them to production.
 Unfortunately, Nodester is not a platform that is supported by Cloud9’s
deploy feature (We have no idea why this is!!! Cloud9, please make this
happen!). Thankfully, Cloud9 uses Git and makes all the commands
available to the user.  Using the new Nodester API Explorer and Cloud9’s
Git implementation, I am going to walk you through publishing your first
Node.js app to Nodester from <del>any</del> <span><strong>every</strong></span> operating
system with a web browser.</p>
<h2>Set up your Cloud9 account.</h2>
<ol>
<li>Go to <a href="http://c9.io"><a href="http://c9.io/">http://c9.io/</a></a></li>
<li>Choose a username</li>
<li>Enter a valid email (they send you an activation email)</li>
<li>Re-enter your email for confirmation</li>
<li>Click the “Sign Me Up” button</li>
<li>Check your email for your confirmation email</li>
<li>Follow the activation link in your email</li>
<li>Choose your password (following any password requirements C9 has)</li>
<li>Re-type the password for confirmation</li>
<li>Click Activate</li>
<li>You will be redirected to your Cloud9 Dashboard (Keep this tab open for now)</li>
</ol>
<h2>Request a Nodester Registration Coupon.</h2>
<ol>
<li>Open (in a new tab) <a href="http://nodester.com"><a href="http://nodester.com/">http://nodester.com/</a></a></li>
<li>Once on Nodester.com, Request your Registration Coupon by clicking
the blue button labeled “Request Registration Coupon”</li>
<li>Enter your email address in the box labeled “Email” and click Send</li>
<li>Wait patiently to receive your Nodester Coupon (many more are being
sent out daily)</li>
<li>Once you receive your Nodester Coupon, you will be able to sign up
for an account at <a href="http://nodester.com/api.html\#explorer" title="Nodester API Explorer"><a href="http://nodester.com/api.html\#explorer">http://nodester.com/api.html\#explorer</a></a></li>
</ol>
<h2>Set up your Nodester account</h2>
<ol>
<li>Expand the “User” option</li>
<li>Click “CreateUser”</li>
<li>The API Explorer will populate the URL</li>
<li>To the right of the URL input, click the little gear button
(<img src="https://apigee.com/images/gear_icon.png" alt="Apigee Gear Icon" title="Gear Icon">)</li>
<li>Clicking the button will bring up the Advanced Options dialogue box</li>
<li>Enter the Nodester Coupon received in the email in the “value” box
next to “coupon”</li>
<li>Enter your email in the “value” box next to “email”</li>
<li>Enter a password in the “value” box next to “password”</li>
<li><p><strong>VERY IMPORTANT:</strong>The RSA Key you enter must be the RSA Key
provided by Cloud9 IDE</p>
<ul>
<li>On the Cloud9 Dashboard, click “Show Your SSH Key” on the right
side, in the “Account Settings” list</li>
<li>Click “Copy” to copy your RSA Key to the clipboard</li>
<li>Paste that RSA Key into the Nodester “Advanced Options” dialogue
in the “value” box next to “rsakey”</li>
</ul>
</li>
<li><p>Enter a username in the “value” box next to “user”</p>
</li>
<li>Leave all the other options as defaults</li>
<li>Click “OK” to save the options and dismiss the dialogue</li>
<li><p>Click the “POST” button to submit your API call</p>
<ul>
<li><p>Your Response should look something like:</p>
<pre><code>HTTP/1.1 200 OK
Content-Length:
20
Content-Type:
application/json; char<span class="operator"><span class="keyword">set</span>=utf-<span class="number">8</span>
<span class="keyword">Connection</span>:
<span class="keyword">close</span>
X-Powered-<span class="keyword">By</span>:
Express{
<span class="string">"status"</span>: <span class="string">"success"</span>
}</code></pre>
</li>
<li><p>If your response does not have the “status” of “success”, you
have to repeat the above steps again (most likely because
something was mistyped, that username is taken, or something
else funky happened).</p>
</li>
</ul>
</li>
<li><p>Now that you have a Nodester account, it’s time to create your first
Nodester app!!!!</p>
</li>
</ol>
<h2>Create a Nodester App</h2>
<p>There are 2 options for creating a Nodester app with the API, I will
walk you through the Nodester Admin Panel (The option I like better) and
then I will walk you through using the Nodester API Explorer.</p>
<h3>Nodester Admin Panel</h3>
<ol>
<li><p>Since you have a Nodester account, you can access the Admin Panel by
entering your username and password at the top of the page.</p>
<ul>
<li>As a new user, your will get an error message on the first page
you see in the Admin Panel, but that is only because it is
looking for your apps and you don’t have any yet.</li>
</ul>
</li>
<li><p>Click “Create New App” in the menu on the left</p>
</li>
<li>Enter the name of the app you wish to create (This is also the
subdomain that your app will be accessed with, e.g.
appname.nodester.com)</li>
<li><p>Enter the file name that you wish to be your startup file (This file
will most likely be where your Node.js app is configured to listen
on your specific port)</p>
<ul>
<li><strong>Personal preference:</strong>I like to use <code>server.js</code> as my start
file because I have encountered issues using <code>app.js</code> as the
start file with Nodester.</li>
</ul>
</li>
<li><p>Once your Nodester app is created, you will see something similar
to: [Nodester Admin Panel Clipping](<img src="http://iceddev.com/wp-content/uploads/2011/12/nodester-admin-panel.jpg" alt="Nodester Admin Panel Clipping">)</p>
<ul>
<li>The port is the port that your app listens on (this will need to
be hardcoded into your app) and the app-status is false because
there is no code inside the app yet.</li>
</ul>
</li>
</ol>
<h3>Nodester API Explorer</h3>
<ol>
<li>If you would rather use the API Explorer, the steps are below:</li>
<li>Expand the “App” option</li>
<li>Click “CreateApp”</li>
<li>On the left side of the URL input box, click the lock icon (<img src="https://apigee.com/images/padlock_icon.png" alt="Apigee
Padlock Icon" title="Padlock Icon">) and select “Basic HTTP”</li>
<li>Enter your Nodester username and password in the dialogue that opens</li>
<li>Open the “Advanced Options” dialogue</li>
<li>Fill in the values for “appname” and “start”</li>
<li>Click “OK”</li>
<li>Click “POST”</li>
<li><p>The response you should get looks like:</p>
<pre><code>HTTP/1.1 200 OK
Content-Length:
182
Content-Type:
application/json
Connection:
close
X-Powered-By:
Express

{
  "status": "success",
  "port": 13092,
  "gitrepo": "git@nodester.com:/node/git/nodester-deploy/4939-840ce8a201f03c7d27852a5bde15b55e.git",
  "<span class="operator"><span class="keyword">start</span><span class="string">": "</span>server.js<span class="string">",
  "</span>running<span class="string">": false,
  "</span>pid<span class="string">": "</span><span class="keyword">unknown</span><span class="string">"
}</code></pre>
</li>
<li><p>Let’s get this app into Cloud9, so we can add some code and get it
running!</p>
</li>
</ol>
<h2>Import Nodester App into Cloud9</h2>
<ol>
<li>Click “Info” and copy the “gitrepo” value from the dialogue box that
opens</li>
<li>In your Cloud9 Dashboard, click the plus button that it points to
while saying “Create a Project Here”</li>
<li>Choose the “Clone from url” option and paste your “gitrepo” value
from Nodester into the box, then click the “Checkout” button</li>
<li>Cloud9 will perform the git clone operation and (once finished) you
will be able to open the project within Cloud9 by selecting the
project and clicking “Start Editing”</li>
<li>Now that you have your project cloned into Cloud9, let’s add some
code!</li>
</ol>
<h2>Add “Hello World” Code</h2>
<ol>
<li>When your project opens, we need to create the start file specified
when creating your Nodester app (I used <code>server.js</code>) by clicking the
plus icon to open an untitled document.</li>
<li><p>For this tutorial, we will just get this app running the Nodejs.org
“Hello World” code with some small tweaks to get it to run on
Nodester and still debug on Cloud9</p>
<ul>
<li><p>Cloud9 requires you to use <code>process.env.C9_PORT</code>as your port for
Node’s <code>.listen()</code>method and Nodester requires you to use a port
specified to your app (They will have this environmental
variable working soon), so I use this modified code for my
“Hello World” app:</p>
<pre><code><span class="keyword">var</span> port = process.env.C9_PORT || <span class="number">13087</span>; <span class="comment">/* Change 13087 to the port specified for your app */</span>

<span class="keyword">var</span> http = <span class="keyword">require</span>(<span class="string">'http'</span>);
http.createServer(<span class="function"><span class="keyword">function</span> <span class="params">(req, res)</span> {</span>
  res.writeHead(<span class="number">200</span>, {<span class="string">'Content-Type'</span>: <span class="string">'text/plain'</span>});
  res.end(<span class="string">'Hello World\n'</span>);
}).listen(port);</code></pre>
</li>
</ul>
</li>
<li><p>Now, you want to save the code in the untitled document as the
filename you specified as your start file when creating your
Nodester app.</p>
</li>
<li>Once saved, clicking the “Run” button will bring up a dialogue box
for a run configuration, where you can name your configuration and
specify which file it is to run as the start file (server.js for
me).  You can then click “Run” on that dialogue box.</li>
<li>In the “Output” tab of your Cloud9 console, you will see a tip with
a clickable link, when click, will launch the webpage for your app
and you should see “Hello World” printed to the screen.</li>
<li>Now that you have your app working in Cloud9, let’s get it onto
Nodester!</li>
</ol>
<h2>Pushing your App to Nodester</h2>
<ol>
<li>Pushing your app to Nodester requires a little knowledge of Git
(even though you don’t install it on your local machine, Cloud9 is
still using it behind the scenes).</li>
<li><p>In the Cloud9 Command Line (at the bottom of the screen), we around
going to want to issue the command (either type or copy-paste):</p>
<pre><code><span class="title">git</span> add .</code></pre>
<p>to add all files to the Git repo.</p>
</li>
<li><p>Next, we want to issue the command:</p>
<pre><code>git <span class="operator"><span class="keyword">commit</span> -m <span class="string">'initial commit'</span></code></pre>
<p>to make our initial commit to the Git repo.</p>
</li>
<li><p>The last command we need to issue is</p>
<pre><code><span class="title">git</span> push origin master</code></pre>
<p>to push our changes to the Nodester Git repo.</p>
</li>
<li><p>Nodester will report on the progress of the push and the restarting
of your app with the committed changes</p>
</li>
<li>If everything went as expected, your app will now be online!</li>
</ol>
<h2>Test Your Nodester App</h2>
<ol>
<li>Direct your web browser to YOUR_APPNAME.nodester.com (my test app
was c9deploy1.nodester.com) to make sure your app is running.</li>
<li>You can stop and start your app from the Nodester Admin Panel if
something isn’t working correctly.</li>
<li>After all of this is setup/configured, the only 3 commands you need
to remember are the Git commands to add, commit, and push your
changes to your Nodester apps!!</li>
</ol>
<h2>That’s All Folks!</h2>
<p>I hope this post helps some people (especially ones developing on
Windows or ChromeOS) with the difficult task of getting your apps hosted
on the Nodester platform using the equally awesome Cloud9 IDE.</p>

  </div>
  <div class="post-navigation">
  
    <span class="comment-link"><a href="./2012-02-25-create-and-deploy-a-nodester-app-without-installing-git-using-cloud9-ide.html#comments">View Comments</a></span>
  
  </div>
</article>

  

</div>
      </article>
    </section>
  </div>

  <footer>
    Copyright Iced Dev, 2013.
  </footer>

  <script src="static/scripts/prism.js"> </script>
</body>
</html>
